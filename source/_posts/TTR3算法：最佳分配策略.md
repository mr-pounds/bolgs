---
dated: 2022-05-16 14:16
updated: 2022-06-21 16:00
title: TTR3算法：最佳分配策略

categories:
  - 策略设计

tags:
---

# TTR3 算法：最佳分配策略

相关企业：

> from 《合适：从升学择校、相亲配对、牌照拍卖了解新兴实用经济学》

**特别说明**
-> 在文中表示 偏好。

使用 TTR3 算法，就不存在通过虚假报告而获利的可能性。这种特性称之为**防策略性**。即某个学生谎报自己喜欢的房间，不会获得更好的结果。

# TTR3 算法使用范围

学生交换住房匹配的问题。

A 的房间为 Room 1，依次类推。房间偏好现在住的学生。

| 学生 | 第一位 | 第二位 | 第三位 | 第四位 | 第五位 | 第六位 |
| ---- | ------ | ------ | ------ | ------ | ------ | ------ |
| A    | Room 3 | Room 6 | Room 1 | Room 2 | Room 4 | Room 5 |
| B    | Room 1 | Room 6 | Room 2 | Room 3 | Room 4 | Room 5 |
| C    | Room 2 | Room 6 | Room 5 | Room 1 | Room 3 | Room 4 |
| D    | Room 3 | Room 1 | Room 6 | Room 2 | Room 5 | Room 4 |
| E    | Room 4 | Room 1 | Room 2 | Room 6 | Room 3 | Room 5 |
| F    | Room 4 | Room 1 | Room 2 | Room 3 | Room 5 | Room 6 |

# TTR3 算法步骤

1. 每个学生指出自己最喜欢的房间；
   | 学生偏好 | 房间偏好 |
   | -------- | -------- |
   | A -> R3 | R1 -> A |
   | B -> R1 | R2 -> B |
   | C -> R2 | R3 -> C |
   | D -> R3 | R4 -> D |
   | E -> R4 | R5 -> E |
   | F -> R4 | R6 -> F |

2. 随意选择一个学生跟房间进行匹配，直至闭环；

   - A -> R3 -> C -> R2 -> B -> R1 -> A ;
   - 故 A, B, C 都能选择自己喜欢的房间，所以离开匹配;
     |学生偏好|房间偏好|
     | ----- | ----- |
     |D -> R6|R4 -> D|
     |E -> R4|R5 -> E|
     |F -> R4|R6 -> F|

3. 继续匹配
   - D -> R6 -> F -> R4 -> D;
   - 故学生 4，6 离开匹配
4. 仅剩余学生 4，只能选择 R5。

# TTR3 算法修正版

现在已拥有房间的是学生 1,2,3,4；要新入住的是学生 5,6,7；空着的房间是 R5，R6，R7

| 学生 | 第一位 | 第二位 | 第三位 | 第四位 | 第五位 | 第六位 | 第七位 |
| ---- | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| A    | R5     | R6     | R7     | R1     | R2     | R3     | R4     |
| B    | R3     | R4     | R5     | R6     | R7     | R1     | R2     |
| C    | R4     | R5     | R2     | R7     | R1     | R3     | R6     |
| D    | R1     | R2     | R3     | R4     | R5     | R6     | R7     |
| E    | R4     | R5     | R2     | R3     | R6     | R7     | R1     |
| F    | R7     | R1     | R2     | R3     | R4     | R5     | R6     |
| G    | R1     | R7     | R4     | R5     | R6     | R3     | R2     |

新增如下规则：

1. 现已有人住的房间，指定该既有住户；即房间 1 偏好学生 1;
2. 现在空着的房间，按照指定顺序最高的学生；即空房间偏好学生 5。

## 运算步骤

1. 按照规则分配房间偏好
   |学生偏好|房间偏好|
   | ----- | ----- |
   |1 -> R5|R1 -> 1|
   |2 -> R3|R2 -> 2|
   |3 -> R4|R3 -> 3|
   |4 -> R1|R4 -> 4|
   |5 -> R4|R5 -> 5|
   |6 -> R7|R6 -> 5|
   |7 -> R1|R7 -> 5|

2. 随意选择一个学生跟房间进行匹配，直至闭环；
   - 1 -> R5 -> 5 -> R4 -> 4 -> R1 -> 1;
   - 故学生 1，4，5 离开匹配
3. 继续匹配
   - 2 -> R3 -> 3 -> R2 -> 2;
   - 故学生 2, 3 离开匹配
4. 继续匹配
   - 6 -> R7 -> 6;
   - 因学生 5 已不在，故房间 7 偏好为学生 6
5. 仅剩余学生 7
   - 7 -> R6 -> 7

# 延迟接收算法

延迟接收算法, Deferred-Acceptance-Algorithm, 现在广泛应用于实习医生匹配、择校匹配等情形；

## 模拟场景

假设 7 个人，1~3 为男性，4~7 为女性。由男性向女性求婚。

男性偏好表，0 为单身。
| 男性 | 第一位 | 第二位 | 第三位 | 第四位 | 第五位 |
| ---- | ------ | ------ | ------ | ------ | ------ |
| 1 | 4 | 5 | 7 | 0 | 6 |
| 2 | 5 | 6 | 4 | 0 | 7 |
| 3 | 4 | 7 | 0 | 6 | 5 |

女性偏好表，0 为单身。
|女性|第一位|第二位|第三位|第四位|
| ----- | ----- | ----- | ----- | ----- |
|4|3|2|1|0|
|5|3|1|2|0|
|6|3|1|0|2|
|7|1|2|0|3|

## 计算步骤

- 第一轮：

> 1 > 4
> 2 > 5
> 3 > 4
> 女性 4 保留 3，女性 5 保留 2；

- 第二轮：

> 1 > 5
> 女性 5，比较 1 和 2 后，保留了 1；

- 第三轮：

> 2 > 6;
> 女性 6，选择单身；

- 第四轮：

> 2 > 4;
> 女性 4，比较了 2 和 3，选择了 3；
> 男性 2 选择单身；

最终结果: 3&4；1&5；2,6,7 选择单身。

## 延迟接受算法的特性

1. 利益一致
   对于男性来说，男性求婚比其他所有稳定匹配（该种匹配不会出现私奔）都要令他们满意；同理，女性也是。

2. 偏僻医院定理
   虽然稳定匹配可能有几个，但是单身无论在哪个匹配中都是单身。这个定理说的是：即使存在两个以上稳定匹配，他们的分配结果其实相差不远。

3. 防策略性
   无法通过假意的求婚改善结果，表明真正的偏好对于求婚方来说，通常是最佳做法。但对于被求婚方，则不然。故称之为延迟接受算法的单边防策略性。
